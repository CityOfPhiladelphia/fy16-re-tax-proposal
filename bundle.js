$(document).ready(function(){function t(t){t.wrap("<div class='table-wrapper' />");var e=t.clone();e.find("td:not(:first-child), th:not(:first-child)").css("display","none"),e.removeClass("responsive"),t.closest(".table-wrapper").append(e),e.wrap("<div class='pinned' />"),t.wrap("<div class='scrollable' />"),a(t,e)}function e(t){t.closest(".table-wrapper").find(".pinned").remove(),t.unwrap(),t.unwrap()}function a(t,e){var a=t.find("tr"),o=e.find("tr"),p=[];a.each(function(t){var e=$(this),a=e.find("th, td");a.each(function(){var e=$(this).outerHeight(!0);p[t]=p[t]||0,e>p[t]&&(p[t]=e)})}),o.each(function(t){$(this).height(p[t])})}var o=!1,p=function(){return $(window).width()<767&&!o?(o=!0,$("table.responsive").each(function(e,a){t($(a))}),!0):void(o&&$(window).width()>767&&(o=!1,$("table.responsive").each(function(t,a){e($(a))})))};$(window).load(p),$(window).on("redraw",function(){o=!1,p()}),$(window).on("resize",p)}),function(t){t.deparam=function(e,a){var o={},p={"true":!0,"false":!1,"null":null};return t.each(e.replace(/\+/g," ").split("&"),function(e,r){var s,n=r.split("="),i=decodeURIComponent(n[0]),c=o,h=0,l=i.split("]["),u=l.length-1;if(/\[/.test(l[0])&&/\]$/.test(l[u])?(l[u]=l[u].replace(/\]$/,""),l=l.shift().split("[").concat(l),u=l.length-1):u=0,2===n.length)if(s=decodeURIComponent(n[1]),a&&(s=s&&!isNaN(s)?+s:"undefined"===s?void 0:void 0!==p[s]?p[s]:s),u)for(;u>=h;h++)i=""===l[h]?c.length:l[h],c=c[i]=u>h?c[i]||(l[h+1]&&isNaN(l[h+1])?{}:[]):s;else t.isArray(o[i])?o[i].push(s):o[i]=void 0!==o[i]?[o[i],s]:s;else i&&(o[i]=a?void 0:"")}),o}}(jQuery);var app={};window.app=app,app.hooks={},$("[data-hook]").each(function(t,e){var a=$(e),o=a.data("hook").replace(/-([a-z])/g,function(t){return t[1].toUpperCase()});app.hooks[o]=a}),$("#templates").detach(),app.hooks.frontLink=$("<a>").attr("href",window.location.pathname).on("click",function(t){if(!(t.ctrlKey||t.altKey||t.shiftKey)){var e=$(t.target),a=e.attr("href");t.preventDefault(),window.scroll(0,0),window.location.search&&(history.pushState(null,e.text(),a),app.views.front())}}),app.hooks.crumbs.update=function(t){var e=this;e.hooks=e.hooks||{},e.hooks.app=e.hooks.app||e.find("li").last(),e.hooks.appText=e.hooks.appText||e.hooks.app.contents(),e.hooks.appLink=e.hooks.appLink||app.hooks.frontLink.clone(!0).text(e.hooks.app.text()),e.hooks.crumb&&e.hooks.crumb.detach(),t?(e.hooks.appText.detach(),e.hooks.app.append(e.hooks.appLink),e.hooks.crumb=t,e.append(e.hooks.crumb)):(e.hooks.appLink.detach(),e.hooks.app.append(e.hooks.appText))},app.hooks.appTitle.contents().wrap(app.hooks.frontLink),app.hooks.search.parent().on("submit",function(t){if(!(t.ctrlKey||t.altKey||t.shiftKey)){t.preventDefault();var e=t.target.elements.q;e.blur(),history.pushState(null,e.value,"?"+$.param({q:e.value})),app.views.results(e.value)}}),app.views={},app.route=function(){var t=$.deparam(window.location.search.substr(1));t.q?app.views.results(t.q):t.p?app.views.property(t.p):app.views.front()},$(app.route),window.onpopstate=app.route,history.pushState||(history.pushState=function(t,e,a){window.location=a},history.replaceState=function(t){history.state=t}),app.util={},app.util.addressWithUnit=function(t){var e=t.unit||"";return e&&(e=" #"+e.replace(/^0+/,"")),t.full_address+e},app.views.front=function(){app.hooks.crumbs.update(),app.hooks.search.val("").attr("placeholder","Enter address, account number, intersection, or city block"),app.hooks.searchLeft.removeClass("medium-14").addClass("medium-4").html("&nbsp;"),app.hooks.searchBox.removeClass("medium-10").addClass("medium-16"),app.hooks.content.children().detach(),app.hooks.content.append(app.hooks.front)},app.views.results=function(t){function e(){var t=history.state;return t.error?app.hooks.content.text(t.error):(app.hooks.content.empty(),app.hooks.count.find("#total").text(t.total),app.hooks.content.append(app.hooks.count),app.hooks.results.empty(),t.data.properties.forEach(function(t){var e=app.hooks.result.clone(),a=t.property_id,o=app.util.addressWithUnit(t),p="?"+$.param({p:a});e.find("a").attr("href",p).text(o).on("click",function(e){e.ctrlKey||e.altKey||e.shiftKey||(e.preventDefault(),history.pushState({opa:t,address:o},o,p),app.views.property(a))}),e.appendTo(app.hooks.results)}),void app.hooks.content.append(app.hooks.results))}function a(t){return-1!==t.indexOf(" #")?t=t.replace(" #","/"):t+="/",t}app.hooks.resultsCrumb.find("b").text(t),app.hooks.crumbs.update(app.hooks.resultsCrumb),app.hooks.search.val(t),app.hooks.searchLeft.removeClass("medium-14").addClass("medium-4").html("&nbsp;"),app.hooks.searchBox.removeClass("medium-10").addClass("medium-16"),app.hooks.content.children().detach(),history.state?e():(app.hooks.content.text("Loading..."),$.ajax("http://api.phila.gov/opa/v1.1/address/"+encodeURIComponent(a(t))+"?format=json").done(function(t){history.replaceState(t,""),e()}).fail(function(){history.replaceState({error:"Failed to retrieve results. Please try another search."},""),e()}))},app.views.property=function(t){function e(){n=!0,$.ajax("http://api.phila.gov/opa/v1.1/property/"+t+"?format=json").done(function(t){var e=$.extend({},history.state),r=t.data.property;e.opa=r,e.address=app.util.addressWithUnit(r),history.replaceState(e,""),i||o(),c||p(),e.sa||a()}).fail(function(){history.replaceState({error:!0},""),s()})}function a(){$.ajax("https://api.phila.gov/ulrs/v3/addresses/"+encodeURIComponent(history.state.address)+"/service-areas?format=json").done(function(t){var e=$.extend({},history.state);e.sa=t.serviceAreaValues,history.replaceState(e,""),r()}).fail(function(){var t=$.extend({},history.state);t.sa={error:!0},history.replaceState(t,"")})}function o(){var t=history.state;app.hooks.propertyCrumb.text(t.address),app.hooks.crumbs.update(app.hooks.propertyCrumb),app.hooks.propertyTitle.find("h1").text(t.address),app.hooks.propertyTitle.find(".small-text").text("#"+t.opa.account_number),app.hooks.content.empty(),app.hooks.propertyOwners.empty(),t.opa.ownership.owners.forEach(function(t){app.hooks.propertyOwners.append($("<div>").text(t))}),app.hooks.improvementDescription.text(t.opa.characteristics.description),app.hooks.landArea.text(t.opa.characteristics.land_area),app.hooks.improvementArea.text(t.opa.characteristics.improvement_area),app.hooks.zoning.text(t.opa.characteristics.zoning_description),app.hooks.propertyMailingHeader.detach(),app.hooks.propertyMailing.empty(),app.hooks.valuation.empty(),app.hooks.content.append(app.hooks.propertySide),app.hooks.content.append(app.hooks.propertyMain),i=!0}function p(){var t=history.state,e=app.hooks.propertyMailing,a=t.opa.ownership.mailing_address;app.hooks.propertyMailingHeader.insertBefore(e),e.append($("<div>").text(a.street)),e.append($("<div>").text(a.city+", "+a.state)),e.append($("<div>").text(a.zip)),t.opa.valuation_history.forEach(function(t){var e=$("<tr>");e.append($("<td>").text(t.certification_year)),e.append($("<td>").text(t.market_value)),e.append($("<td>").text(t.improvement_taxable)),e.append($("<td>").text(t.land_taxable)),e.append($("<td>").text(t.total_exempt)),e.append($("<td>").text(t.taxes)),app.hooks.valuation.append(e)}),c=!0}function r(){var t=history.state;t.error||t.sa.error||i&&t.sa&&t.sa.forEach(function(t){switch(t.serviceAreaId){case"SA_STREETS_Rubbish_Recyc":return app.hooks.rubbishDay.text(t.value);case"SA_SCHOOLS_Elementary_School_Catchment":return app.hooks.elementarySchool.text(t.value);case"SA_SCHOOLS_Middle_School_Catchment":return app.hooks.middleSchool.text(t.value);case"SA_SCHOOLS_High_School_Catchment":return app.hooks.highSchool.text(t.value);case"SA_PLANNING_2016Councilmanic":return app.hooks.councilDistrict.text(t.value);case"SA_PLANNING_Ward":return app.hooks.ward.text(t.value);case"SA_PLANNING_Ward_Divisions":return app.hooks.wardDivisions.text(t.value);case"SA_POLICE_PSA":return app.hooks.policePsa.text(t.value);case"SA_POLICE_District":return app.hooks.policeDistrict.text(t.value);case"SA_POLICE_Sector":return app.hooks.policeSector.text(t.value);case"SA_POLICE_Division":return app.hooks.policeDivision.text(t.value);case"SA_POLICE_FireDistricts":return app.hooks.fireDistrict.text(t.value);case"SA_STREETS_Highway_District":return app.hooks.highwayDistrict.text(t.value);case"SA_STREETS_Highway_Section":return app.hooks.highwaySection.text(t.value);case"SA_STREETS_Highway_Subsection":return app.hooks.highwaySubsection.text(t.value);case"SA_STREETS_Street_Lights_Routes":return app.hooks.streetLightRoutes.text(t.value);case"SA_Streets_Traffic_District":return app.hooks.trafficDistrict.text(t.value);case"SA_STREETS_Recycling_Diversion_Rate":return app.hooks.recyclingDiversion.text(t.value);case"SA_STREETS_Sanitation_Area":return app.hooks.sanitationArea.text(t.value);case"SA_STREETS_Sanitation_Districts":return app.hooks.sanitationDistrict.text(t.value);case"SA_STREETS_Leaf":return app.hooks.leafCollection.text(t.value);case"SA_Streets_Traffic_PM_District":return app.hooks.trafficPmDistrict.text(t.value);case"SA_PLANNING_Planning_Districts":return app.hooks.planning.text(t.value);case"SA_PWD_CenterCityDistrict":return app.hooks.pwdCenterCity.text(t.value);case"SA_CENTER_CITY_DISTRICT":return app.hooks.centerCity.text(t.value);case"SA_STREETS_HISTORIC":return app.hooks.historic.text(t.value);case"SA_RECREATION_Recreation_District":return app.hooks.recreation.text(t.value);case"SA_PHILLYRISING":return app.hooks.phillyRising.text(t.value);case"PWD_MAINT_DIST":return app.hooks.pwdMaintenance.text(t.value);case"PWD_PRES_DIST":return app.hooks.pwdPressure.text(t.value);case"PWD_WTPSA":return app.hooks.waterTreatment.text(t.value);case"SA_WATER_Water_Plate_Index":return app.hooks.waterPlate.text(t.value)}})}function s(){}var n,i,c;return app.hooks.propertyTitle.find("h1").html("&nbsp;"),app.hooks.propertyTitle.find(".small-text").empty(),app.hooks.search.val(""),app.hooks.search.attr("placeholder","Search for another property"),app.hooks.searchLeft.removeClass("medium-4").addClass("medium-14").empty().append(app.hooks.propertyTitle),app.hooks.searchBox.removeClass("medium-16").addClass("medium-10"),app.hooks.content.children().detach(),history.state||history.replaceState({},""),history.state.error?s():(history.state.opa?o():(app.hooks.content.text("Loading..."),e()),history.state.opa&&!history.state.opa.address_match?p():n||e(),void(history.state.sa?r():history.state.address&&a()))};
!function(e){e.deparam=function(t,a){var p={},s={"true":!0,"false":!1,"null":null};return e.each(t.replace(/\+/g," ").split("&"),function(t,r){var n,o=r.split("="),i=decodeURIComponent(o[0]),l=p,c=0,d=i.split("]["),u=d.length-1;if(/\[/.test(d[0])&&/\]$/.test(d[u])?(d[u]=d[u].replace(/\]$/,""),d=d.shift().split("[").concat(d),u=d.length-1):u=0,2===o.length)if(n=decodeURIComponent(o[1]),a&&(n=n&&!isNaN(n)?+n:"undefined"===n?void 0:void 0!==s[n]?s[n]:n),u)for(;u>=c;c++)i=""===d[c]?l.length:d[c],l=l[i]=u>c?l[i]||(d[c+1]&&isNaN(d[c+1])?{}:[]):n;else e.isArray(p[i])?p[i].push(n):p[i]=void 0!==p[i]?[p[i],n]:n;else i&&(p[i]=a?void 0:"")}),p}}(jQuery);var app={};window.app=app,app.els={},$("[data-hook]").each(function(e,t){var a=$(t),p=a.data("hook").replace(/-([a-z])/g,function(e){return e[1].toUpperCase()});app.els[p]=a}),$("#templates").detach(),app.els.frontLink=$("<a>").attr("href",window.location.pathname).on("click",function(e){if(!(e.ctrlKey||e.altKey||e.shiftKey)){var t=$(e.target),a=t.attr("href");e.preventDefault(),window.scroll(0,0),window.location.search&&(history.pushState(null,t.text(),a),app.views.front())}}),app.els.crumbs.update=function(e){var t=this;t.els=t.els||{},t.els.app=t.els.app||t.find("li").last(),t.els.appText=t.els.appText||t.els.app.contents(),t.els.appLink=t.els.appLink||app.els.frontLink.clone(!0).text(t.els.app.text()),t.els.crumb&&t.els.crumb.detach(),e?(t.els.appText.detach(),t.els.app.append(t.els.appLink),t.els.crumb=e,t.append(t.els.crumb)):(t.els.appLink.detach(),t.els.app.append(t.els.appText))},app.els.appTitle.contents().wrap(app.els.frontLink),app.els.search.parent().on("submit",function(e){if(!(e.ctrlKey||e.altKey||e.shiftKey)){e.preventDefault();var t=e.target.elements.q;t.blur(),history.pushState(null,t.value,"?"+$.param({q:t.value})),app.views.results(t.value)}}),app.views={},app.route=function(){var e=$.deparam(window.location.search.substr(1));e.q?app.views.results(e.q):e.p?app.views.property(e.p):app.views.front()},$(app.route),window.onpopstate=app.route,history.pushState||(history.pushState=function(e,t,a){window.location=a},history.replaceState=function(e){history.state=e}),app.util={},app.util.addressWithUnit=function(e){var t=e.unit||"";return t&&(t=" #"+t.replace(/^0+/,"")),e.full_address+t},app.views.front=function(){app.els.crumbs.update(),app.els.search.val("").attr("placeholder","Enter address, account number, intersection, or city block"),app.els.searchLeft.removeClass("medium-14").addClass("medium-4").html("&nbsp;"),app.els.searchBox.removeClass("medium-10").addClass("medium-16"),app.els.content.children().detach(),app.els.content.append(app.els.front)},app.views.results=function(e){function t(){var e=history.state;return e.error?app.els.content.text(e.error):(app.els.content.empty(),app.els.count.find("#total").text(e.total),app.els.content.append(app.els.count),app.els.results.empty(),e.data.properties.forEach(function(e){var t=app.els.result.clone(),a=e.property_id,p=app.util.addressWithUnit(e),s="?"+$.param({p:a});t.find("a").attr("href",s).text(p).on("click",function(t){t.ctrlKey||t.altKey||t.shiftKey||(t.preventDefault(),history.pushState({opa:e,address:p},p,s),app.views.property(a))}),t.appendTo(app.els.results)}),void app.els.content.append(app.els.results))}function a(e){return-1!==e.indexOf(" #")?e=e.replace(" #","/"):e+="/",e}app.els.resultsCrumb.find("b").text(e),app.els.crumbs.update(app.els.resultsCrumb),app.els.search.val(e),app.els.searchLeft.removeClass("medium-14").addClass("medium-4").html("&nbsp;"),app.els.searchBox.removeClass("medium-10").addClass("medium-16"),app.els.content.children().detach(),history.state?t():(app.els.content.text("Loading..."),$.ajax("http://api.phila.gov/opa/v1.1/address/"+encodeURIComponent(a(e))+"?format=json").done(function(e){history.replaceState(e,""),t()}).fail(function(){history.replaceState({error:"Failed to retrieve results. Please try another search."},""),t()}))},app.views.property=function(e){function t(){o=!0,$.ajax("http://api.phila.gov/opa/v1.1/property/"+e+"?format=json").done(function(e){var t=$.extend({},history.state),r=e.data.property;t.opa=r,t.address=app.util.addressWithUnit(r),history.replaceState(t,""),i||p(),l||s(),t.sa||a()}).fail(function(){history.replaceState({error:!0},""),n()})}function a(){$.ajax("https://api.phila.gov/ulrs/v3/addresses/"+encodeURIComponent(history.state.address)+"/service-areas?format=json").done(function(e){var t=$.extend({},history.state);t.sa=e.serviceAreaValues,history.replaceState(t,""),r()}).fail(function(){var e=$.extend({},history.state);e.sa={error:!0},history.replaceState(e,"")})}function p(){var e=history.state;app.els.propertyCrumb.text(e.address),app.els.crumbs.update(app.els.propertyCrumb),app.els.propertyTitle.find("h1").text(e.address),app.els.propertyTitle.find(".small-text").text("#"+e.opa.account_number),app.els.content.empty(),app.els.propertyOwners.empty(),e.opa.ownership.owners.forEach(function(e){app.els.propertyOwners.append($("<div>").text(e))}),app.els.improvementDescription.text(e.opa.characteristics.description),app.els.landArea.text(e.opa.characteristics.land_area),app.els.improvementArea.text(e.opa.characteristics.improvement_area),app.els.zoning.text(e.opa.characteristics.zoning_description),app.els.propertyMailingHeader.detach(),app.els.propertyMailing.empty(),app.els.valuation.empty(),app.els.content.append(app.els.propertySide),app.els.content.append(app.els.propertyMain),i=!0}function s(){var e=history.state,t=app.els.propertyMailing,a=e.opa.ownership.mailing_address;app.els.propertyMailingHeader.insertBefore(t),t.append($("<div>").text(a.street)),t.append($("<div>").text(a.city+", "+a.state)),t.append($("<div>").text(a.zip)),e.opa.valuation_history.forEach(function(e){var t=$("<tr>");t.append($("<td>").text(e.certification_year)),t.append($("<td>").text(e.market_value)),t.append($("<td>").text(e.improvement_taxable)),t.append($("<td>").text(e.land_taxable)),t.append($("<td>").text(e.total_exempt)),t.append($("<td>").text(e.taxes)),app.els.valuation.append(t)}),l=!0}function r(){var e=history.state;e.error||e.sa.error||i&&e.sa&&e.sa.forEach(function(e){"SA_STREETS_Rubbish_Recyc"===e.serviceAreaId?app.els.rubbishDay.text(e.value):"SA_SCHOOLS_Elementary_School_Catchment"===e.serviceAreaId&&app.els.elementarySchool.text(e.value)})}function n(){}var o,i,l;return app.els.propertyTitle.find("h1").html("&nbsp;"),app.els.propertyTitle.find(".small-text").empty(),app.els.search.val(""),app.els.search.attr("placeholder","Search for another property"),app.els.searchLeft.removeClass("medium-4").addClass("medium-14").empty().append(app.els.propertyTitle),app.els.searchBox.removeClass("medium-16").addClass("medium-10"),app.els.content.children().detach(),history.state||history.replaceState({},""),history.state.error?n():(history.state.opa?p():(app.els.content.text("Loading..."),t()),history.state.opa&&!history.state.opa.address_match?s():o||t(),void(history.state.sa?r():history.state.address&&a()))};
function homeClick(e){if(!(e.ctrlKey||e.altKey||e.shiftKey)&&history.pushState){var p=$(e.target),a=p.attr("href");e.preventDefault(),window.scroll(0,0),window.location.search&&(history.pushState(null,p.text(),a),app.render(e))}}function opaAddress(e){return-1!==e.indexOf(" #")?e=e.replace(" #","/"):e+="/",e}!function(e){e.deparam=function(p,a){var t={},r={"true":!0,"false":!1,"null":null};return e.each(p.replace(/\+/g," ").split("&"),function(p,s){var n,o=s.split("="),l=decodeURIComponent(o[0]),i=t,c=0,d=l.split("]["),u=d.length-1;if(/\[/.test(d[0])&&/\]$/.test(d[u])?(d[u]=d[u].replace(/\]$/,""),d=d.shift().split("[").concat(d),u=d.length-1):u=0,2===o.length)if(n=decodeURIComponent(o[1]),a&&(n=n&&!isNaN(n)?+n:"undefined"===n?void 0:void 0!==r[n]?r[n]:n),u)for(;u>=c;c++)l=""===d[c]?i.length:d[c],i=i[l]=u>c?i[l]||(d[c+1]&&isNaN(d[c+1])?{}:[]):n;else e.isArray(t[l])?t[l].push(n):t[l]=void 0!==t[l]?[t[l],n]:n;else l&&(t[l]=a?void 0:"")}),t}}(jQuery);var app={};window.app=app,app.els={appLink:$("<a>").attr("href",window.location.pathname)},$("[data-hook]").each(function(e,p){var a=$(p),t=a.data("hook").replace(/-([a-z])/g,function(e){return e[1].toUpperCase()});app.els[t]=a}),$("#templates").detach(),app.els.appCrumbText=app.els.appCrumb.contents(),app.els.appCrumbLink=app.els.appLink.clone().text(app.els.appCrumb.text()),app.els.appLink.on("click",homeClick),app.els.appCrumbLink.on("click",homeClick),app.views={titleLink:function(){app.els.appTitle.contents().wrap(app.els.appLink)},breadcrumbs:function(e){e?(app.els.appCrumbText.detach(),app.els.appCrumbLink.appendTo(app.els.appCrumb),app.els.crumb.text(e).appendTo(app.els.appCrumb.parent())):(app.els.appCrumbLink.detach(),app.els.appCrumbText.appendTo(app.els.appCrumb),app.els.crumb.detach())},search:function(e,p){e?app.els.search.val(e):(app.els.search.val(""),app.els.search.attr("placeholder",p))},count:function(e){app.els.count.find("#total").text(e),app.els.count.appendTo(app.els.content)},loading:function(){app.els.content.children().detach(),app.els.content.text("Loading...")},front:function(){app.els.searchLeft.off("transitionend").removeClass("medium-14").addClass("medium-4").html("&nbsp;"),app.els.searchBox.removeClass("medium-10").addClass("medium-16"),app.els.content.children().detach(),app.els.content.append(app.els.front)},result:function(e){var p=app.els.result.clone(),a=e.property_id,t=e.unit||"";t=t.replace(/^0+/,""),t&&(t=" #"+t);var r=e.full_address+t,s="?"+$.param({p:a});p.find("a").attr("href",s).text(r).on("click",function(p){p.ctrlKey||p.altKey||p.shiftKey||history.pushState&&(p.preventDefault(),history.pushState({opa:e,address:r},r,s),app.render(p))}),p.appendTo(app.els.results)},resultsPreFetch:function(e){app.views.breadcrumbs("Search Results"),app.views.search(e),app.els.searchLeft.off("transitionend").removeClass("medium-14").addClass("medium-4").html("&nbsp;"),app.els.searchBox.removeClass("medium-10").addClass("medium-16")},results:function(e){return history.replaceState&&!history.state&&history.replaceState(e),e.error?app.els.content.text(e.error):(app.els.content.empty(),app.views.count(e.total),app.els.results.empty(),e.data.properties.forEach(app.views.result),void app.els.results.appendTo(app.els.content))},property:function(e){var p=history.state;app.views.propertyTitle(),app.els.content.empty(),p?app.views.propertyOpa(p):$.ajax("http://api.phila.gov/opa/v1.1/property/"+e+"?format=json").done(function(e){p.opa=e.data.property}).fail(function(){p.opa={error:"Failed to retrieve OPA address data."}})},propertyOpa:function(e){app.els.propertyTitle.find("h1").text(e.address),app.els.propertyTitle.find(".small-text").text("#"+e.opa.account_number)},propertyOpaDetails:function(){},propertyTitle:function(){app.views.breadcrumbs("Address"),app.els.propertyTitle.find("h1").html("&nbsp;"),app.els.propertyTitle.find(".small-text").empty(),app.els.search.val(""),app.els.search.attr("placeholder","Search for another property"),app.els.searchLeft.removeClass("medium-4").addClass("medium-14").on("transitionend",function(e){$(e.target).empty().append(app.els.propertyTitle)}),app.els.searchBox.removeClass("medium-16").addClass("medium-10")}},app.views.titleLink(),app.render=function(e){var p=$.deparam(window.location.search.substr(1));p.q?(app.views.resultsPreFetch(p.q),history.state?app.views.results(history.state):(app.views.loading(),$.ajax("http://api.phila.gov/opa/v1.1/address/"+encodeURIComponent(opaAddress(p.q))+"?format=json").done(function(e){app.views.results(e)}).fail(function(){var e={error:"Failed to retrieve results. Please try another search."};app.views.results(e)}))):p.p?app.views.property(p.p):(app.views.breadcrumbs(),app.views.search(null,"Enter address, account number, intersection, or city block"),app.views.front())},app.render(),window.onpopstate=app.render,app.els.search.parent().on("submit",function(e){if(history.pushState){e.preventDefault();var p=e.target.elements.q;p.blur(),history.pushState(null,p.value,"?"+$.param({q:p.value})),app.render(e)}});